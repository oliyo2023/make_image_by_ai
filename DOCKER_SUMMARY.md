# Docker é•œåƒåˆ¶ä½œå®Œæˆ - é¡¹ç›®æ€»ç»“

## ğŸ‰ æ­å–œï¼Docker é•œåƒåˆ¶ä½œå·²å®Œæˆ

æ‚¨çš„ AI å›¾åƒç”Ÿæˆé¡¹ç›®ç°åœ¨å·²ç»å®Œå…¨æ”¯æŒ Docker å®¹å™¨åŒ–éƒ¨ç½²ã€‚ä»¥ä¸‹æ˜¯ä¸ºæ‚¨åˆ›å»ºçš„å®Œæ•´ Docker è§£å†³æ–¹æ¡ˆã€‚

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶åˆ—è¡¨

### æ ¸å¿ƒ Docker æ–‡ä»¶
- **`Dockerfile`** - æ ‡å‡†å¤šé˜¶æ®µæ„å»ºé•œåƒï¼ˆæ¨èç”Ÿäº§ä½¿ç”¨ï¼‰
- **`Dockerfile.minimal`** - æœ€å°åŒ–é•œåƒï¼ˆé€‚ç”¨äºèµ„æºå—é™ç¯å¢ƒï¼‰
- **`.dockerignore`** - Docker æ„å»ºæ—¶å¿½ç•¥çš„æ–‡ä»¶åˆ—è¡¨
- **`docker-compose.yml`** - å®¹å™¨ç¼–æ’é…ç½®ï¼ˆåŒ…å« Redis æ”¯æŒï¼‰

### ç¯å¢ƒé…ç½®
- **`.env.example`** - ç¯å¢ƒå˜é‡æ¨¡æ¿æ–‡ä»¶
- **`.env`** - å®é™…ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰

### éƒ¨ç½²è„šæœ¬
- **`deploy.sh`** - Linux/macOS éƒ¨ç½²è„šæœ¬
- **`deploy.bat`** - Windows éƒ¨ç½²è„šæœ¬ï¼ˆå®Œæ•´ç‰ˆï¼‰
- **`deploy-simple.bat`** - Windows ç®€åŒ–éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

### æ–‡æ¡£
- **`DOCKER.md`** - è¯¦ç»†çš„ Docker ä½¿ç”¨æŒ‡å—
- **`DOCKER_EXAMPLES.md`** - å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹å’Œæ•…éšœæ’é™¤

### Makefile æ‰©å±•
- å·²æ›´æ–° **`Makefile`** æ·»åŠ äº† Docker ç›¸å…³å‘½ä»¤

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3 åˆ†é’Ÿéƒ¨ç½²ï¼‰

### Windows ç”¨æˆ·ï¼ˆæ¨èï¼‰

```batch
# 1. è®¾ç½®ç¯å¢ƒ
.\\deploy-simple.bat setup

# 2. ç¼–è¾‘ API å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
notepad .env

# 3. æ„å»ºé•œåƒ
.\\deploy-simple.bat build

# 4. è¿è¡ŒæœåŠ¡
.\\deploy-simple.bat run

# 5. æŸ¥çœ‹çŠ¶æ€
.\\deploy-simple.bat status
```

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# 1. ç¼–è¾‘ç¯å¢ƒå˜é‡
notepad .env  # æˆ–æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬ Redisï¼‰
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

**å¿…éœ€é…ç½®** - è¯·åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š
```bash
MODEL_SCOPE_TOKEN=your-model-scope-token
OPENROUTER_API_KEY=your-openrouter-api-key
```

**å¯é€‰é…ç½®**ï¼š
- ç«¯å£è®¾ç½®ï¼š`PORT=8000`
- å›¾ç‰‡å­˜å‚¨ï¼š`IMAGES_DIR=/app/public/static/images`
- Cloudflare R2/D1 é…ç½®
- å›¾ç‰‡å¤„ç†å‚æ•°
- æ—¥å¿—é…ç½®

## ğŸ“Š æœåŠ¡è®¿é—®

æœåŠ¡å¯åŠ¨åå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **å›¾åƒç”Ÿæˆ**: http://localhost:8000/generate-image
- **ç¿»è¯‘æœåŠ¡**: http://localhost:8000/translate
- **å›¾ç‰‡åˆ—è¡¨**: http://localhost:8000/images
- **é™æ€æ–‡ä»¶**: http://localhost:8000/static/images/

## ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### Windows ç”¨æˆ·
```batch
.\\deploy-simple.bat status    # æŸ¥çœ‹çŠ¶æ€
.\\deploy-simple.bat logs      # æŸ¥çœ‹æ—¥å¿—
.\\deploy-simple.bat stop      # åœæ­¢æœåŠ¡
.\\deploy-simple.bat clean     # æ¸…ç†èµ„æº
```

### Docker Compose ç”¨æˆ·
```bash
docker-compose ps             # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose logs -f        # æŸ¥çœ‹æ—¥å¿—
docker-compose down           # åœæ­¢æœåŠ¡
docker-compose restart        # é‡å¯æœåŠ¡
```

### ç›´æ¥ Docker å‘½ä»¤
```bash
docker ps                              # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker logs -f ai-image-generator      # æŸ¥çœ‹æ—¥å¿—
docker stop ai-image-generator         # åœæ­¢å®¹å™¨
docker start ai-image-generator        # å¯åŠ¨å®¹å™¨
```

## ğŸ” æµ‹è¯•æœåŠ¡

### 1. å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8000/health
```

### 2. ç¿»è¯‘æµ‹è¯•
```bash
curl -X POST http://localhost:8000/translate \\
  -H \"Content-Type: application/json\" \\
  -d '{\"text\": \"ä¸€åªå¯çˆ±çš„å°çŒ«å’ª\"}'
```

### 3. å›¾åƒç”Ÿæˆæµ‹è¯•
```bash
curl -X POST http://localhost:8000/generate-image \\
  -H \"Content-Type: application/json\" \\
  -d '{\"prompt\": \"ä¸€åªå¯çˆ±çš„å°çŒ«å’ª\", \"model\": \"google/gemini-2.5-flash-image-preview:free\"}'
```

## ğŸ“ æ•°æ®æŒä¹…åŒ–

### æŒ‚è½½ç›®å½•
- `./public/static/images` â†’ ç”Ÿæˆçš„å›¾ç‰‡å­˜å‚¨
- `./logs` â†’ åº”ç”¨æ—¥å¿—æ–‡ä»¶

### Redis æ•°æ®ï¼ˆä½¿ç”¨ docker-compose æ—¶ï¼‰
- æ•°æ®å­˜å‚¨åœ¨ Docker å· `redis_data` ä¸­

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- âœ… ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œå®¹å™¨
- âœ… å¤šé˜¶æ®µæ„å»ºå‡å°‘æ”»å‡»é¢
- âœ… ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- âœ… å¥åº·æ£€æŸ¥ç›‘æ§
- âœ… èµ„æºé™åˆ¶å’Œé‡å¯ç­–ç•¥
- âœ… **è‹±æ–‡æç¤ºä¿¡æ¯** - æ‰€æœ‰éƒ¨ç½²è„šæœ¬ä½¿ç”¨è‹±æ–‡æç¤ºï¼Œé¿å…å‘½ä»¤è¡Œä¹±ç é—®é¢˜

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### é•œåƒå¤§å°å¯¹æ¯”
- **æ ‡å‡†é•œåƒ** (`Dockerfile`): ~100MBï¼ˆåŒ…å«å®Œæ•´è¿è¡Œæ—¶ï¼‰
- **æœ€å°é•œåƒ** (`Dockerfile.minimal`): ~20MBï¼ˆåŸºäº scratchï¼‰

### èµ„æºå»ºè®®
- **CPU**: 1-2 æ ¸å¿ƒ
- **å†…å­˜**: 1-2GB
- **å­˜å‚¨**: 5GB+ï¼ˆç”¨äºç”Ÿæˆçš„å›¾ç‰‡ï¼‰

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Ÿ**
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
.\\deploy-simple.bat logs
# æˆ–
docker logs ai-image-generator
```

**Q: API è°ƒç”¨å¤±è´¥ï¼Ÿ**
- æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ API å¯†é’¥æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- éªŒè¯ API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ

**Q: æ— æ³•è®¿é—®ç”Ÿæˆçš„å›¾ç‰‡ï¼Ÿ**
- æ£€æŸ¥ `public/static/images` ç›®å½•æ˜¯å¦æ­£ç¡®æŒ‚è½½
- ç¡®è®¤å®¹å™¨å†…æ–‡ä»¶æƒé™æ­£å¸¸

**Q: å†…å­˜ä¸è¶³ï¼Ÿ**
```bash
# é™åˆ¶å®¹å™¨å†…å­˜ä½¿ç”¨
docker update --memory=\"2g\" ai-image-generator
```

## ğŸŒŸ é«˜çº§åŠŸèƒ½

### 1. å¤šå®ä¾‹éƒ¨ç½²
```bash
# ä½¿ç”¨ä¸åŒç«¯å£è¿è¡Œå¤šä¸ªå®ä¾‹
docker run -d --name ai-gen-1 -p 8001:8000 ai-image-generator:latest
docker run -d --name ai-gen-2 -p 8002:8000 ai-image-generator:latest
```

### 2. è´Ÿè½½å‡è¡¡
ä½¿ç”¨ nginx æˆ– traefik è¿›è¡Œè´Ÿè½½å‡è¡¡

### 3. ç›‘æ§é›†æˆ
- é›†æˆ Prometheus/Grafana ç›‘æ§
- é…ç½®æ—¥å¿—æ”¶é›†ç³»ç»Ÿ
- è®¾ç½®å‘Šè­¦é€šçŸ¥

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **`DOCKER.md`** - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œé…ç½®è¯´æ˜
- **`DOCKER_EXAMPLES.md`** - å®Œæ•´çš„ç¤ºä¾‹å’Œæ•…éšœæ’é™¤
- **`README.md`** - é¡¹ç›®æ€»ä½“è¯´æ˜
- **`API_DOCS.md`** - API æ¥å£æ–‡æ¡£

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **é…ç½® API å¯†é’¥** - ç¼–è¾‘ `.env` æ–‡ä»¶è®¾ç½®æ‚¨çš„å®é™… API å¯†é’¥
2. **æµ‹è¯•æœåŠ¡** - ä½¿ç”¨æä¾›çš„æµ‹è¯•å‘½ä»¤éªŒè¯æœåŠ¡æ­£å¸¸è¿è¡Œ
3. **ç”Ÿäº§éƒ¨ç½²** - è€ƒè™‘ä½¿ç”¨ docker-compose è¿›è¡Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
4. **ç›‘æ§è®¾ç½®** - é…ç½®æ—¥å¿—ç›‘æ§å’Œæ€§èƒ½ç›‘æ§
5. **å¤‡ä»½ç­–ç•¥** - åˆ¶å®šç”Ÿæˆå›¾ç‰‡å’Œé…ç½®çš„å¤‡ä»½è®¡åˆ’

## ğŸ’¡ æç¤º

- åˆæ¬¡ä½¿ç”¨å»ºè®®å…ˆä½¿ç”¨ `deploy-simple.bat` è„šæœ¬
- ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ `docker-compose.yml`
- å®šæœŸæ›´æ–°åŸºç¡€é•œåƒä»¥è·å¾—å®‰å…¨è¡¥ä¸
- ç›‘æ§ç£ç›˜ç©ºé—´ï¼Œç”Ÿæˆçš„å›¾ç‰‡ä¼šå ç”¨å­˜å‚¨ç©ºé—´

---

ğŸ‰ **æ­å–œæ‚¨å®Œæˆäº† Docker é•œåƒåˆ¶ä½œï¼ç°åœ¨æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ä»»ä½•æ”¯æŒ Docker çš„ç¯å¢ƒä¸­éƒ¨ç½²æ‚¨çš„ AI å›¾åƒç”ŸæˆæœåŠ¡äº†ã€‚**

å¦‚éœ€å¸®åŠ©ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–æŸ¥çœ‹å®¹å™¨æ—¥å¿—è¿›è¡Œæ•…éšœæ’é™¤ã€‚